<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>線上考程表 By Liao Bob</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@700&family=Noto+Sans+TC:wght@500;700&display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet"/>
    <script src="https://cdn.tailwindcss.com?plugins=forms"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: { "primary": "#1e3a8a", "slate-deep": "#0f172a" },
                    fontFamily: { "display": ["Noto Sans TC", "sans-serif"], "clock": ["'Roboto Mono'", "monospace"] },
                },
            },
        }
    </script>
    <style>
        #big-clock { font-family: 'Roboto Mono', monospace; font-size: 14rem; font-weight: 700; color: #0f172a; letter-spacing: -0.02em; line-height: 1; font-variant-numeric: tabular-nums; }
        .active-row { background-color: #ffffff !important; border-left: 12px solid #1e3a8a !important; transform: scale(1.02); z-index: 10; box-shadow: 0 10px 25px -5px rgba(30, 58, 138, 0.2); transition: all 0.5s ease; }
        .dashboard-container { aspect-ratio: 16 / 9; max-height: 100vh; width: 100%; position: relative; }
        #scroll-container { scroll-behavior: smooth; }
        #scroll-container::-webkit-scrollbar { width: 0; background: transparent; }
    </style>
</head>

<body class="bg-slate-100 text-slate-900 font-display h-screen w-screen overflow-hidden flex items-center justify-center">

    <div class="dashboard-container bg-white shadow-2xl flex flex-col relative">
        <div class="h-[62vh] flex flex-col p-8 pb-4">
            <header class="flex items-center justify-between mb-4 px-4">
                <div class="flex items-center gap-4">
                    <div class="bg-primary p-2 rounded-lg text-white shadow-lg"><span class="material-symbols-outlined text-3xl">calendar_today</span></div>
                    <h1 id="main-title" class="text-4xl font-bold tracking-tight text-slate-deep"></h1>
                </div>
                <div class="flex items-center gap-3">
                    <button class="p-3 rounded-full hover:bg-slate-100 border border-slate-200 transition-all" onclick="toggleFullScreen()"><span id="fs-icon" class="material-symbols-outlined text-slate-500 text-2xl">fullscreen</span></button>
                    <button class="p-3 rounded-full hover:bg-slate-100 border border-slate-200 transition-all" onclick="openModal()"><span class="material-symbols-outlined text-slate-500 text-2xl">settings</span></button>
                </div>
            </header>
            <div class="flex-1 overflow-hidden rounded-2xl border border-slate-200 bg-slate-50 relative">
                <div id="scroll-container" class="absolute inset-0 overflow-y-auto p-4">
                    <table class="w-full text-left border-separate border-spacing-y-3">
                        <thead class="sticky top-0 bg-slate-50 z-20"><tr class="text-slate-400"><th class="py-2 px-10 text-xl font-bold w-1/4">時間</th><th class="py-2 px-10 text-xl font-bold w-1/4">科目</th><th class="py-2 px-10 text-xl font-bold w-1/2">備註</th></tr></thead>
                        <tbody id="schedule-tbody"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="h-[38vh] flex flex-col items-center justify-center bg-white border-t border-slate-100 relative">
            <span class="text-slate-400 text-xl font-bold tracking-[0.5em] mb-2 uppercase">Current Time</span>
            <div id="big-clock">00:00:00</div>
            
            <div class="absolute bottom-4 right-6 text-slate-400 font-medium select-none" style="font-size: 19px;">
                本網頁由 Liao Bob 設計製作
            </div>
        </div>
    </div>

    <div id="settings-modal" class="hidden absolute inset-0 z-50 bg-slate-900/60 backdrop-blur-sm flex items-center justify-center p-8">
        <div class="bg-white w-full max-w-5xl h-[90vh] rounded-2xl shadow-2xl flex flex-col overflow-hidden">
            <div class="px-8 py-6 border-b flex justify-between items-center bg-white">
                <h2 class="text-2xl font-bold text-primary">⚙️ 管理考程</h2>
                <div class="flex gap-2">
                    <button onclick="toggleBulkMode()" class="bg-slate-100 hover:bg-slate-200 text-slate-700 px-4 py-2 rounded-lg font-bold flex items-center gap-2 transition-all">
                        <span class="material-symbols-outlined text-xl">dataset</span> 批量文本處理
                    </button>
                    <button onclick="closeModal()" class="text-slate-400 hover:text-slate-600 text-3xl transition-all">&times;</button>
                </div>
            </div>
            
            <div class="flex-1 flex overflow-hidden relative">
                <div id="input-section" class="w-1/3 p-8 bg-slate-50 border-r space-y-6">
                    <div class="bg-blue-50 p-4 rounded-xl border border-blue-100 mb-2">
                        <p id="edit-mode-indicator" class="text-blue-700 font-bold text-sm">狀態：新增模式</p>
                    </div>
                    <div>
                        <label class="block text-sm font-bold mb-2">開始 / 結束時間</label>
                        <div class="grid grid-cols-2 gap-2 mb-2"><select id="start-h" class="rounded-lg border-slate-300"></select><select id="start-m" class="rounded-lg border-slate-300"></select></div>
                        <div class="grid grid-cols-2 gap-2"><select id="end-h" class="rounded-lg border-slate-300"></select><select id="end-m" class="rounded-lg border-slate-300"></select></div>
                    </div>
                    <input id="in-subject" type="text" placeholder="科目名稱" class="w-full h-12 rounded-lg border-slate-300 shadow-sm focus:ring-primary">
                    <input id="in-note" type="text" placeholder="備註 (選填)" class="w-full h-12 rounded-lg border-slate-300 shadow-sm focus:ring-primary">
                    <div class="flex gap-2">
                        <button id="add-btn" onclick="addSchedule()" class="flex-1 bg-primary text-white py-4 rounded-xl font-bold shadow-lg hover:brightness-110 transition-all">確認提交</button>
                        <button id="cancel-edit-btn" onclick="resetInput()" class="hidden w-20 bg-slate-200 text-slate-600 py-4 rounded-xl font-bold hover:bg-slate-300 transition-all">取消</button>
                    </div>
                </div>
                <div class="w-2/3 p-8 overflow-y-auto bg-white space-y-3">
                    <div id="admin-list" class="space-y-3"></div>
                </div>
                <div id="bulk-section" class="hidden absolute inset-0 bg-white z-20 p-8 flex flex-col space-y-4">
                    <h3 class="text-xl font-bold text-slate-700">批量匯入 / 匯出數據</h3>
                    <textarea id="bulk-text" class="flex-1 w-full rounded-xl border-slate-300 font-mono text-sm p-4" placeholder="格式: 08:00-09:00,科目,備註"></textarea>
                    <div class="flex justify-end gap-3">
                        <button onclick="exportToText()" class="px-6 py-2 bg-slate-100 text-slate-700 rounded-lg font-bold">重新整理匯出</button>
                        <button onclick="importFromText()" class="px-6 py-2 bg-primary text-white rounded-lg font-bold">確認匯入</button>
                        <button onclick="toggleBulkMode()" class="px-6 py-2 bg-slate-200 text-slate-600 rounded-lg font-bold">返回</button>
                    </div>
                </div>
            </div>
            <div class="p-6 border-t text-right bg-white"><button onclick="closeModal()" class="bg-primary text-white px-12 py-3 rounded-xl font-bold text-lg hover:scale-105 transition-all">完成並關閉</button></div>
        </div>
    </div>

    <script>
        let schedules = JSON.parse(localStorage.getItem('exams')) || [];
        let currentActiveIndex = -1, editingIndex = -1;

        function toggleFullScreen() { if (!document.fullscreenElement) document.documentElement.requestFullscreen(); else document.exitFullscreen(); }
        document.addEventListener('fullscreenchange', () => { document.getElementById('fs-icon').textContent = document.fullscreenElement ? 'fullscreen_exit' : 'fullscreen'; });
        
        function updateDateTitle() {
            const now = new Date();
            const dateStr = `民國 ${now.getFullYear()-1911} 年 ${now.getMonth()+1} 月 ${now.getDate()} 日`;
            document.getElementById('main-title').textContent = `${dateStr}　　今日考程表`;
        }

        function initSelects() {
            const hs = [document.getElementById('start-h'), document.getElementById('end-h')];
            const ms = [document.getElementById('start-m'), document.getElementById('end-m')];
            hs.forEach(s => { for(let i=0; i<24; i++) s.add(new Option(String(i).padStart(2,'0')+'時', String(i).padStart(2,'0'))); });
            ms.forEach(s => { for(let i=0; i<60; i+=5) s.add(new Option(String(i).padStart(2,'0')+'分', String(i).padStart(2,'0'))); });
            resetInput();
        }

        function updateClock() {
            const now = new Date();
            const h = String(now.getHours()).padStart(2, '0'), m = String(now.getMinutes()).padStart(2, '0'), s = String(now.getSeconds()).padStart(2, '0');
            document.getElementById('big-clock').textContent = `${h}:${m}:${s}`;
            renderMainTable(`${h}:${m}`);
        }

        function renderMainTable(currentTime) {
            const tbody = document.getElementById('schedule-tbody');
            const sorted = [...schedules].sort((a,b) => a.start.localeCompare(b.start));
            tbody.innerHTML = '';
            sorted.forEach((item, index) => {
                const isActive = currentTime >= item.start && currentTime <= item.end;
                const row = document.createElement('tr');
                if (isActive) {
                    row.className = "active-row bg-white ring-2 ring-primary/10";
                    if (currentActiveIndex !== index) { currentActiveIndex = index; setTimeout(() => row.scrollIntoView({ behavior: 'smooth', block: 'center' }), 100); }
                } else { row.className = "bg-white border border-slate-100 text-slate-400 opacity-60 transition-all duration-500"; }
                row.innerHTML = `<td class="py-8 px-10 text-3xl font-bold ${isActive ? 'text-primary' : ''}">${item.start} - ${item.end}</td><td class="py-8 px-10 text-5xl font-bold ${isActive ? 'text-slate-deep' : ''}">${item.subject}</td><td class="py-8 px-10 text-2xl font-medium">${item.note}</td><td class="pr-10 text-right">${isActive ? '<span class="px-6 py-2 rounded-full bg-primary text-white font-bold text-xl inline-block">進行中</span>' : ''}</td>`;
                tbody.appendChild(row);
            });
            if (!sorted.some(it => currentTime >= it.start && currentTime <= it.end)) currentActiveIndex = -1;
        }

        function renderAdminList() {
            const list = document.getElementById('admin-list');
            list.innerHTML = '';
            schedules.forEach((item, index) => {
                const div = document.createElement('div');
                div.className = `flex items-center justify-between p-5 rounded-xl border transition-all ${editingIndex === index ? 'border-primary ring-2 ring-primary/10 bg-blue-50' : 'bg-slate-50'}`;
                div.innerHTML = `<div class="text-xl"><b>${item.start}-${item.end}</b> <span class="ml-4 font-bold text-slate-700">${item.subject}</span></div><div class="flex gap-2"><button onclick="startEdit(${index})" class="text-primary font-bold hover:bg-white px-4 py-2 rounded-lg border border-transparent hover:border-primary">編輯</button><button onclick="deleteSchedule(${index})" class="text-red-500 font-bold hover:bg-red-100 px-4 py-2 rounded-lg">刪除</button></div>`;
                list.appendChild(div);
            });
            localStorage.setItem('exams', JSON.stringify(schedules));
        }

        function startEdit(index) {
            editingIndex = index;
            const item = schedules[index];
            const [sh, sm] = item.start.split(':'), [eh, em] = item.end.split(':');
            document.getElementById('start-h').value = sh; document.getElementById('start-m').value = sm;
            document.getElementById('end-h').value = eh; document.getElementById('end-m').value = em;
            document.getElementById('in-subject').value = item.subject;
            document.getElementById('in-note').value = item.note;
            document.getElementById('add-btn').textContent = "更新考程項目";
            document.getElementById('edit-mode-indicator').textContent = "狀態：編輯模式 (項目 #" + (index+1) + ")";
            document.getElementById('cancel-edit-btn').classList.remove('hidden');
            renderAdminList();
        }

        function resetInput() {
            editingIndex = -1;
            document.getElementById('in-subject').value = ''; document.getElementById('in-note').value = '';
            document.getElementById('add-btn').textContent = "確認提交";
            document.getElementById('edit-mode-indicator').textContent = "狀態：新增模式";
            document.getElementById('cancel-edit-btn').classList.add('hidden');
            renderAdminList();
        }

        function addSchedule() {
            const start = document.getElementById('start-h').value + ":" + document.getElementById('start-m').value;
            const end = document.getElementById('end-h').value + ":" + document.getElementById('end-m').value;
            const subject = document.getElementById('in-subject').value;
            const note = document.getElementById('in-note').value;
            if(!subject) return alert('請輸入科目名稱');
            if(editingIndex > -1) schedules[editingIndex] = {start, end, subject, note};
            else schedules.push({start, end, subject, note});
            resetInput();
        }

        function deleteSchedule(index) { if(confirm('確定刪除？')) { if(editingIndex === index) resetInput(); schedules.splice(index, 1); renderAdminList(); } }

        function toggleBulkMode() {
            const bulkSec = document.getElementById('bulk-section');
            bulkSec.classList.toggle('hidden');
            if (!bulkSec.classList.contains('hidden')) exportToText();
        }

        function exportToText() {
            document.getElementById('bulk-text').value = schedules.map(it => `${it.start}-${it.end},${it.subject},${it.note}`).join('\n');
        }

        function importFromText() {
            const text = document.getElementById('bulk-text').value.trim();
            if (!text) return;
            try {
                const lines = text.split('\n');
                schedules = lines.map(line => {
                    const [time, subject, note] = line.split(',');
                    const [start, end] = time.split('-');
                    return { start: start.trim(), end: end.trim(), subject: subject.trim(), note: (note || '').trim() };
                });
                renderAdminList();
                toggleBulkMode();
            } catch (e) { alert('匯入格式有誤'); }
        }

        function openModal() { document.getElementById('settings-modal').classList.remove('hidden'); resetInput(); }
        function closeModal() { document.getElementById('settings-modal').classList.add('hidden'); }

        window.onload = () => { updateDateTitle(); initSelects(); setInterval(updateClock, 1000); updateClock(); };
    </script>
</body>
</html>